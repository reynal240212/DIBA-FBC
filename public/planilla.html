<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <title>Planilla Interactiva - DIBA FBC</title>
  <meta name="author" content="REINALDO DE JESUS PEREZ NAVAS" />
  <meta name="keywords" content="DIBA FBC, Deportivo Internacional De Barranquilla Atlántico, Fútbol, Barranquilla, Atlántico, Colombia" />
  <meta name="robots" content="index, follow" />
  <meta name="theme-color" content="#002a40" />
  <meta name="apple-mobile-web-app-status-bar-style" content="#002a40" />
  <meta name="msapplication-navbutton-color" content="#002a40" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="mobile-web-app-capable" content="yes" />
  <meta name="HandheldFriendly" content="True" />
  <meta name="MobileOptimized" content="320" />
  <link rel="icon" href="images/ESCUDO.ico" sizes="32x32">
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <meta name="description" content="Conoce la historia y los momentos más destacados de DIBA FBC, un recorrido lleno de pasión y logros deportivos." />
  <!-- Bootstrap 5.3.2 CSS -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet" />

  <!-- Font Awesome -->
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.7.2/css/all.min.css" crossorigin="anonymous" referrerpolicy="no-referrer" />

  <!-- Animate.css -->
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/4.1.1/animate.min.css" />

  <!-- AOS (opcional) -->
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/aos/2.3.4/aos.css" />

  <!-- Estilos globales y de fondo -->
  <link rel="stylesheet" href="styles/styles.css" />
  <link rel="stylesheet" href="styles/background-animation.css" />
  
  <!-- Carga jsPDF y jsPDF-AutoTable -->
  <script src="https://cdn.jsdelivr.net/npm/jspdf@2.5.1/dist/jspdf.umd.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/jspdf-autotable@3.5.25/dist/jspdf.plugin.autotable.min.js"></script>
  
  <style>
    /* Estilos para mejorar la apariencia de la tabla */
    body {
      padding: 20px;
    }
    .table-responsive {
      max-height: 70vh; /* Altura máxima para la tabla antes de hacer scroll */
    }
    .table input[type="text"] {
      width: 100%;
      border: 1px solid #ccc;
      border-radius: 4px;
      padding: 4px 6px;
    }
  </style>
</head>
<body>
  <!-- Contenedor para el Navbar (se cargará desde layout/navbar.html) -->
  <div id="navbar-container"></div>

  <div class="container mt-4">
    <h1 class="mb-3">Planilla Interactiva - DIBA FBC</h1>
    
    <!-- Campo para seleccionar la fecha -->
    <div class="mb-3">
        <label for="planillaDate" class="form-label"><b>Seleccione la Fecha de la Planilla:</b></label>
        <input type="date" class="form-control" id="planillaDate" style="width: 200px;">
    </div>

    <!-- Tabla HTML para llenar los datos -->
    <div class="table-responsive">
      <table class="table table-striped table-bordered" id="planillaTable">
        <thead class="table-dark">
          <tr>
            <th style="width: 5%;">#</th>
            <th style="width: 35%;">Nombre</th>
            <th style="width: 20%;">Pagos</th>
            <th style="width: 20%;">Asistencia</th>
            <th style="width: 20%;">Disciplina</th>
          </tr>
        </thead>
        <tbody id="planillaBody">
          <!-- Las filas se generarán aquí con JavaScript -->
        </tbody>
      </table>
    </div>

    <!-- Botón para generar y descargar el PDF -->
    <button id="generatePDF" class="btn btn-primary mt-3">
      <i class="fas fa-file-pdf"></i> Descargar Planilla en PDF
    </button>
  </div>
  
  <div id="footer-container" class="mt-5"></div>
  
  <script>
    // Lista de nombres para poblar la tabla
    const playerNames = [
      "Mario", "Juan Andrés", "Jhoyfran", "Nayareth", "Eliuth", "Abraham",
      "Rey David", "Santy h", "Santy t", "ISAAC", "Carlos", "Zaid",
      "Keyner", "ALAN", "Cristian", "Dilan sanchez", "Juan t", "Dinkol",
      "Dany", "Miguel", "Rodríguez", "Nelson", "Santiago", "Joseth",
      "Hernández angel", "Oscar", "Yojainer", "Jesus", "Mateo", "Dilan correa"
    ];

    // Función para poblar la tabla HTML al cargar la página
    function populateTable() {
      const tableBody = document.getElementById('planillaBody');
      playerNames.forEach((name, index) => {
        const row = `
          <tr>
            <td>${index + 1}</td>
            <td>${name}</td>
            <td><input type="text" class="form-control form-control-sm" placeholder="$"></td>
            <td><input type="text" class="form-control form-control-sm" placeholder="P / A / E"></td>
            <td><input type="text" class="form-control form-control-sm" placeholder="Observación"></td>
          </tr>
        `;
        tableBody.innerHTML += row;
      });
    }

    // Llama a la función cuando el DOM esté completamente cargado
    document.addEventListener('DOMContentLoaded', populateTable);


    // Función auxiliar: convierte una imagen externa a Base64
    async function getBase64ImageFromUrl(imageUrl) {
      try {
        const res = await fetch(imageUrl);
        const blob = await res.blob();
        return new Promise((resolve) => {
          const reader = new FileReader();
          reader.onloadend = () => resolve(reader.result);
          reader.readAsDataURL(blob);
        });
      } catch (err) {
        console.error("Error al cargar la imagen:", err);
        return "";
      }
    }
  
    document.getElementById("generatePDF").addEventListener("click", async () => {
      const { jsPDF } = window.jspdf;
      
      const doc = new jsPDF({
        orientation: 'portrait',
        unit: 'pt',
        format: 'letter'
      });
      
      const logoUrl = "https://i.postimg.cc/x8W7vwJJ/ESCUDO.png";
      const imgData = await getBase64ImageFromUrl(logoUrl);
      if (imgData) {
        doc.addImage(imgData, 'PNG', 40, 20, 60, 60);
      } else {
        console.warn("No se pudo cargar el logo.");
      }
      
      // Encabezados y títulos
      doc.setFontSize(14);
      doc.text("DIBA FBC", 120, 40);
      doc.setFontSize(10);
      doc.text("DEPORTIVO INTERNACIONAL DE BARRANQUILLA ATLANTICO", 120, 55);
      doc.text("RESOLUCIÓN 0122 /2018- 10/SEPT/2018", 120, 70);
      doc.setFontSize(12);
      doc.text("Planilla de control de asistencia, disciplina y pagos", 120, 95);
      
      // Obtener la fecha del input y formatearla si es necesario
      let planillaDate = document.getElementById('planillaDate').value;
      if (planillaDate) {
        // Opcional: formatear la fecha a dd/mm/yyyy
        const dateParts = planillaDate.split('-');
        planillaDate = `${dateParts[2]}/${dateParts[1]}/${dateParts[0]}`;
      } else {
        planillaDate = "_________________"; // Si no se selecciona fecha
      }
      doc.setFontSize(10);
      doc.text(`Fecha: ${planillaDate}`, 40, 90);
      
      // --- LECTURA DE DATOS DESDE LA TABLA HTML ---
      const columns = ["#", "Nombre", "Pagos", "Asistencia", "Disciplina"];
      const rowsData = [];
      const tableRows = document.querySelectorAll("#planillaBody tr");

      tableRows.forEach(row => {
          const cells = row.querySelectorAll("td");
          const rowData = [
              cells[0].textContent, // #
              cells[1].textContent, // Nombre
              cells[2].querySelector('input').value, // Valor del input de pagos
              cells[3].querySelector('input').value, // Valor del input de asistencia
              cells[4].querySelector('input').value  // Valor del input de disciplina
          ];
          rowsData.push(rowData);
      });
      
      // Generar la tabla en el PDF con los datos leídos
      doc.autoTable({
        head: [columns],
        body: rowsData, // Usamos los datos leídos de la tabla HTML
        startY: 110, // Un poco más abajo para no chocar con los títulos
        margin: { left: 40, right: 40 },
        styles: {
          fontSize: 9,
          cellPadding: 4,
          halign: 'center',
          valign: 'middle'
        },
        headStyles: {
          fillColor: [0, 42, 64], // #002a40
          textColor: 255
        },
        alternateRowStyles: {
          fillColor: [240, 240, 240]
        },
        tableWidth: 'auto',
        pageBreak: 'auto'
      });
      
      // Descargar el PDF
      doc.save(`Planilla_DIBA_${new Date().toISOString().slice(0,10)}.pdf`);
    });
  </script>
  
  <!-- Carga de otros scripts y componentes -->
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
  <script src="scripts/loadComponents.js"></script>
  <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
  <script src="scripts/main.js"></script>
  <script src="scripts/script.js"></script>
</body>
</html>