<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sistema de Facturación Rápida</title>
    
    <!-- Dependencias (Bootstrap 5 y Font Awesome) -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css">

    <style>
        body {
            background-color: #f0f2f5;
        }
        .invoice-header {
            background-color: #002a40;
            color: #ffffff;
        }
        .invoice-header img {
            max-height: 60px;
        }
        .card {
            border: none;
            box-shadow: 0 0.5rem 1rem rgba(0,0,0,.1);
        }
        .total-section {
            background-color: #e9ecef;
            border-radius: 0.5rem;
        }
        .btn-add-item {
            border-style: dashed;
        }

        /* Estilos para impresión */
        @media print {
            body * {
                visibility: hidden;
            }
            #receipt-modal .modal-content, #receipt-modal .modal-content * {
                visibility: visible;
            }
            #receipt-modal {
                position: absolute;
                left: 0;
                top: 0;
                width: 100%;
                height: 100%;
                overflow: visible;
            }
            .modal-dialog {
                max-width: 100% !important;
                margin: 0;
            }
            .no-print {
                display: none;
            }
        }
    </style>
</head>
<body>

    <nav class="navbar navbar-dark invoice-header">
        <div class="container">
            <a class="navbar-brand" href="#">
                <img src="https://i.postimg.cc/x8W7vwJJ/ESCUDO.png" alt="Logo" class="me-2">
                <strong>Sistema de Facturación</strong>
            </a>
        </div>
    </nav>

    <main class="container my-4">
        <div class="card p-4">
            <!-- Datos del Cliente y Factura -->
            <div class="row g-4 mb-4">
                <div class="col-md-6">
                    <h5>Datos del Cliente:</h5>
                    <div class="mb-2">
                        <label for="clientName" class="form-label">Nombre o Razón Social</label>
                        <input type="text" class="form-control" id="clientName" placeholder="Nombre completo del cliente" required>
                    </div>
                    <div>
                        <label for="clientId" class="form-label">Cédula o NIT</label>
                        <input type="text" class="form-control" id="clientId" placeholder="Documento de identidad">
                    </div>
                </div>
                <div class="col-md-6">
                    <h5>Detalles de la Factura:</h5>
                    <div class="mb-2">
                        <label for="invoiceNumber" class="form-label">Nº de Factura</label>
                        <input type="text" class="form-control" id="invoiceNumber" value="FACT-001">
                    </div>
                    <div>
                        <label for="invoiceDate" class="form-label">Fecha de Emisión</label>
                        <input type="date" class="form-control" id="invoiceDate">
                    </div>
                </div>
            </div>

            <!-- Items de la Factura -->
            <h5 class="mt-3">Conceptos a Facturar:</h5>
            <div class="table-responsive">
                <table class="table table-hover align-middle">
                    <thead class="table-light">
                        <tr>
                            <th scope="col" style="width: 50%;">Descripción</th>
                            <th scope="col" style="width: 15%;">Cantidad</th>
                            <th scope="col" style="width: 15%;">Vlr. Unitario</th>
                            <th scope="col" style="width: 15%;">Total</th>
                            <th scope="col" class="text-center"></th>
                        </tr>
                    </thead>
                    <tbody id="invoice-items">
                        <!-- Las filas se añadirán aquí con JavaScript -->
                    </tbody>
                </table>
            </div>
            <button id="add-item-btn" class="btn btn-outline-primary btn-add-item mt-2">
                <i class="fas fa-plus me-2"></i>Añadir nuevo concepto
            </button>

            <!-- Totales -->
            <div class="row mt-4 justify-content-end">
                <div class="col-md-5">
                    <div class="p-3 total-section">
                        <div class="d-flex justify-content-between mb-2">
                            <span>Subtotal:</span>
                            <strong id="subtotal">$0.00</strong>
                        </div>
                        <div class="d-flex justify-content-between mb-2">
                            <span>IVA (19%):</span>
                            <strong id="iva">$0.00</strong>
                        </div>
                        <hr>
                        <div class="d-flex justify-content-between h4">
                            <span>TOTAL A PAGAR:</span>
                            <strong id="total">$0.00</strong>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Botón de Generación -->
            <div class="text-center mt-4">
                <button id="generate-invoice-btn" class="btn btn-lg btn-success">
                    <i class="fas fa-file-invoice-dollar me-2"></i>Generar Factura y Volante de Pago
                </button>
            </div>
        </div>
    </main>

    <!-- Modal para el Volante de Pago -->
    <div class="modal fade" id="receipt-modal" tabindex="-1" aria-hidden="true">
        <div class="modal-dialog modal-dialog-centered">
            <div class="modal-content border-2 border-primary">
                <div class="modal-header text-center invoice-header">
                    <h5 class="modal-title w-100"><i class="fas fa-receipt me-2"></i>VOLANTE DE PAGO</h5>
                    <button type="button" class="btn-close btn-close-white no-print" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body p-4">
                    <p class="text-center"><strong>EMPRESA/NEGOCIO XYZ</strong><br>
                    <small>NIT: 900.123.456-7<br>
                    Calle Falsa 123, Barranquilla - Tel: 300 123 4567</small></p>
                    <hr>
                    <div class="row">
                        <div class="col-6"><strong>Factura Nº:</strong></div>
                        <div class="col-6 text-end"><span id="receipt-invoice-number"></span></div>
                    </div>
                    <div class="row">
                        <div class="col-6"><strong>Fecha:</strong></div>
                        <div class="col-6 text-end"><span id="receipt-date"></span></div>
                    </div>
                    <hr>
                    <p><strong>Recibido de:</strong> <span id="receipt-client-name"></span><br>
                    <strong>C.C./NIT:</strong> <span id="receipt-client-id"></span></p>
                    <div class="p-3 text-center bg-light rounded my-3">
                        <p class="mb-1">Valor a Pagar:</p>
                        <h2 class="display-6 fw-bold text-success" id="receipt-total"></h2>
                    </div>
                    <p class="small text-center">Este es un comprobante de la deuda registrada. No es válido como factura final sin sello o firma de recibido.</p>
                </div>
                <div class="modal-footer no-print">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cerrar</button>
                    <button type="button" class="btn btn-primary" onclick="window.print();"><i class="fas fa-print me-2"></i>Imprimir Volante</button>
                </div>
            </div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
    <script>
        document.addEventListener('DOMContentLoaded', () => {
            const addItemBtn = document.getElementById('add-item-btn');
            const invoiceItemsContainer = document.getElementById('invoice-items');
            const generateInvoiceBtn = document.getElementById('generate-invoice-btn');
            const receiptModalEl = document.getElementById('receipt-modal');
            const receiptModal = new bootstrap.Modal(receiptModalEl);

            // Asignar fecha actual al campo de fecha
            document.getElementById('invoiceDate').valueAsDate = new Date();

            const calculateTotals = () => {
                let subtotal = 0;
                const items = invoiceItemsContainer.querySelectorAll('tr');

                items.forEach(item => {
                    const quantity = parseFloat(item.querySelector('.item-quantity').value) || 0;
                    const price = parseFloat(item.querySelector('.item-price').value) || 0;
                    const totalField = item.querySelector('.item-total');
                    
                    const lineTotal = quantity * price;
                    totalField.textContent = formatCurrency(lineTotal);
                    subtotal += lineTotal;
                });

                const iva = subtotal * 0.19;
                const total = subtotal + iva;

                document.getElementById('subtotal').textContent = formatCurrency(subtotal);
                document.getElementById('iva').textContent = formatCurrency(iva);
                document.getElementById('total').textContent = formatCurrency(total);
            };
            
            const formatCurrency = (value) => {
                return new Intl.NumberFormat('es-CO', { style: 'currency', currency: 'COP', minimumFractionDigits: 0 }).format(value);
            };

            const addNewItem = () => {
                const itemId = Date.now();
                const itemRow = document.createElement('tr');
                itemRow.setAttribute('id', `item-${itemId}`);
                itemRow.innerHTML = `
                    <td><input type="text" class="form-control" placeholder="Descripción del producto o servicio"></td>
                    <td><input type="number" class="form-control item-quantity" value="1" min="1"></td>
                    <td><input type="number" class="form-control item-price" placeholder="10000" step="100"></td>
                    <td class="item-total fw-bold">${formatCurrency(0)}</td>
                    <td class="text-center">
                        <button class="btn btn-sm btn-outline-danger remove-item-btn"><i class="fas fa-trash-alt"></i></button>
                    </td>
                `;
                invoiceItemsContainer.appendChild(itemRow);
                calculateTotals();
            };
            
            addItemBtn.addEventListener('click', addNewItem);

            invoiceItemsContainer.addEventListener('input', (e) => {
                if (e.target.classList.contains('item-quantity') || e.target.classList.contains('item-price')) {
                    calculateTotals();
                }
            });

            invoiceItemsContainer.addEventListener('click', (e) => {
                const removeBtn = e.target.closest('.remove-item-btn');
                if (removeBtn) {
                    removeBtn.closest('tr').remove();
                    calculateTotals();
                }
            });

            generateInvoiceBtn.addEventListener('click', () => {
                const clientName = document.getElementById('clientName').value;
                if (!clientName) {
                    alert('Por favor, ingrese el nombre del cliente.');
                    return;
                }
                if (invoiceItemsContainer.children.length === 0) {
                    alert('Por favor, añada al menos un concepto a la factura.');
                    return;
                }

                // Poblar el modal del volante
                document.getElementById('receipt-invoice-number').textContent = document.getElementById('invoiceNumber').value;
                document.getElementById('receipt-date').textContent = new Date(document.getElementById('invoiceDate').value + 'T00:00:00').toLocaleDateString('es-CO');
                document.getElementById('receipt-client-name').textContent = clientName;
                document.getElementById('receipt-client-id').textContent = document.getElementById('clientId').value;
                document.getElementById('receipt-total').textContent = document.getElementById('total').textContent;

                receiptModal.show();
            });

            // Añadir un item inicial
            addNewItem();
        });
    </script>
</body>
</html>